<!DOCTYPE html>
<html>
<head>
{{template "./public/head.tpl"}}
</head>
<body class="no-skin">
<style type="text/css">
    .form-horizontal .form-group {
        margin-right: 0px;
    }
</style>
<!-- #section:basics/navbar.layout -->
<div id="navbar" class="navbar navbar-default">

    <div class="navbar-container" id="navbar-container">{{template "./public/page_header.tpl" .}}</div>
</div>
<div class="main-container" id="main-container">
    <script type="text/javascript">
        try {
            ace.settings.check('main-container', 'fixed')
        } catch (e) {
        }
    </script>
    <div id="sidebar" class="sidebar responsive">
    {{template "./public/meun.tpl" .}}
    </div>
    <div class="main-content">
        <div class="main-content-inner">
            <div class="breadcrumbs" id="breadcrumbs">
            {{template "./public/ur_here.tpl" .}}
            </div>

            <div class="page-content">
                <div style="float:left;" class="form-inline">

                    <div class="form-group">
                        <label>用户名称</label>
                        <input type="text" class="form-control" name="s_values" id="mySearch" filter="true"/>
                    </div>
                </div>
                <button onclick="search()" class="btn btn-white btn-info" id>搜索</button>
                <button type="button" class="btn btn-white btn-primary" style="float:right;margin-bottom: 5px;"
                        onclick="add()">添 加
                </button>
                <table id="myTable" class="table table-striped table-bordered table-hover dataTable no-footer"
                       cellspacing="0" width="100%">
                    <thead>
                    </thead>

                </table>

            </div>
        </div>
    </div>
</div>

{{template "./public/base_script.tpl"}}

<script type="text/javascript">

        var table = $('#myTable').DataTable({

            language: {
                "lengthMenu": '每页显示<select>' + '<option value="1">1</option>' + '<option value="2">2</option>' + '<option value="3">3</option><select>',
                "paginate": {
                    "first": "首页",
                    "last": "尾页",
                    "previous": "上一页",
                    "next": "下一页",
                },
                "processing": "加载中...",  //DataTables载入数据时，是否显示‘进度’提示
                "info": "共 _PAGES_ 页  _TOTAL_ 条数据  ",
                "infoEmpty": "暂无数据",
                "emptyTable": "暂无要处理的数据...",  //表格中无数据
                "search": "搜索:",
                "infoFiltered": " —— 从  _MAX_ 条数据中筛选",
                "zeroRecords": "没有找到记录",

            },
            searching: true,
            serverSide: true,
            ajax: {
                url: "/user/ajaxdata",
                type: "POST"
            },
            columns: [
                {
                    "data": "Id",
                    "title":"ID",
                    "name": "id",
                    "sDefaultContent": "",  //默认空字符串
                    "sClass": "text-center"
                },
                {
                    "orderable": true,
                    "data": "Name",
                    "title":"名称",
                    "name": "name",
                    'sClass': "text-center"
                },
                {
                    "orderable": true,
                    "data": "Password",
                    "title":"密码",
                    "name": "password",
                    'sClass': "text-center"
                }, {
                    "data": "Role",
                    "name": "role",
                    "title":"所属角色"
                }, {
                    "data": "Status",
                    "name": "status",
                    "title":"状态",

                },
                {
                    "data": null,
                    "title":"操作",
                    "createdCell":function (nTd, sData, oData, iRow, iCol) {
                        var html = '<a class="hover" onclick="edit('+sData.Id+')">编辑</a>&nbsp;&nbsp;&nbsp;';
                        html += '<a class="hover" onclick="del('+sData.Id+')">删除</a>';
                        $(nTd).html(html);
                    }
                },
            ],

        });


        function search(){
            table.search($('#mySearch').val()).draw(false);
           /* $('#mySearch').on( 'keyup', function () {
                table.columns(1).search( this.value ).draw();
            } );*/
        }




    /*
     * 添加网站列表
     * */
    function add() {
        layer.open({
            type: 2,
            title: '添加用户',
            shadeClose: false,
            shade: 0.1,
            area: ['80%', "550px"],
            content: "/authorization/WebAdmin/AddQuery"
        });

    }

    /**
     * 编辑
     * @param id
     * @param name
     */
    function edit(id) {
        var returnData = null;
        $.post("/authorization/Agentlist/EditQuery", {"Id": id}, function (d) {
            returnData = d.ResultObject;
            if (d.Result == "1") {  //编辑操作~!
                $('#Agentid').val(d.ResultObject.Agentid);
                $('#Agentname').val(d.ResultObject.Agentname);
                $('#Weburl').val(d.ResultObject.Weburl);
                $('#csort').val(d.ResultObject.Sort);

                //处理多选框
                if (d.ResultObject.Isforeign == "1") {
                    $('#Isforeign').attr('checked', 'checked');
                } else {
                    $('#Isforeign').removeAttr('checked');
                }

                //处理select框
                $("#Projectid option").each(function () {
                    if ($(this).attr('value') == d.ResultObject.Projectid) {
                        $(this).attr("selected", "selected");
                        return false;
                    }
                });

            } else {
                layer.msg(d.ResultString);
            }
        }, "JSON");

        /*
         * 编辑提交
         * */
        showDiv($('#loadhtml'), '修改平台信息', function () {
            //编辑提交逻辑

            //提取数据
            var args = {
                "Id": returnData.Id,
                "Agentid": $.trim($('#Agentid').val()),
                "Agentname": $.trim($('#Agentname').val()),
                "Projectid": $.trim($('#Projectid').val()),
                "Weburl": $.trim($('#Weburl').val()),
                "Sort": $.trim($('#csort').val()),
                "Isforeign": $('#Isforeign').is(":checked") ? 1 : 0
            };
            if (args.Agentid < 1 || args.Agentname.length < 2 /*|| args.Weburl.length<10*/) {
                layer.alert("请将信息填写完整");
                return false;
            } else {
                $.post("/authorization/Agentlist/Edit", args, function (d) {
                    layer.msg(d.ResultString);
                    if (d.Result == "1") myTable.search();
                }, "JSON")
            }

            $(this).dialog('close');
        }, '确定', '返回', 700);
    }

    function del(id) {
        $.post("/authorization/Agentlist/Del", {"id": id}, function (d) {
            if (d.Result == "1") {  //删除操作~!
                myTable.search();
            } else {
                layer.msg(d.ResultString);
            }
        }, "JSON");
    }

</script>
</body>
</html>
